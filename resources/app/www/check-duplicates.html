<!DOCTYPE html>
<html>
<head><title>Check Duplicates</title></head>
<body>
<h2>Checking for Duplicate Orders...</h2>
<pre id="output"></pre>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
import { getFirestore, collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyDUtblUqNiSCmC4kRjikE7D2kba0Mhxej4",
    authDomain: "danfosal-app.firebaseapp.com",
    projectId: "danfosal-app",
    storageBucket: "danfosal-app.appspot.com",
    messagingSenderId: "565855692028",
    appId: "1:565855692028:web:c7cb647497cb3df9452379"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const output = document.getElementById('output');

async function checkDuplicates() {
    try {
        // Get all online orders
        const ordersSnap = await getDocs(collection(db, 'onlineOrders'));
        
        output.textContent += '=== CHECKING ELONA SMAKAJ ORDERS ===\n\n';
        
        const elonaOrders = [];
        ordersSnap.docs.forEach(doc => {
            const data = doc.data();
            const customer = (data.clientName || '').toLowerCase();
            if (customer.includes('elona') || customer.includes('smakaj')) {
                elonaOrders.push({
                    id: doc.id,
                    customer: data.clientName,
                    address: data.address || data.deliveryAddress,
                    phone: data.phoneNumber || data.telephone || data.phone,
                    items: data.items,
                    total: data.total || data.price,
                    timestamp: data.timestamp,
                    status: data.status
                });
            }
        });
        
        output.textContent += 'Found ' + elonaOrders.length + ' documents for Elona Smakaj\n\n';
        
        elonaOrders.forEach((order, index) => {
            output.textContent += '--- Order ' + (index + 1) + ' ---\n';
            output.textContent += 'Doc ID: ' + order.id + '\n';
            output.textContent += 'Customer: ' + order.customer + '\n';
            output.textContent += 'Phone: ' + order.phone + '\n';
            output.textContent += 'Address: ' + order.address + '\n';
            output.textContent += 'Status: ' + order.status + '\n';
            output.textContent += 'Total: ' + order.total + '\n';
            if (order.items && order.items.length > 0) {
                output.textContent += 'Items:\n';
                order.items.forEach((item, i) => {
                    output.textContent += '  ' + (i+1) + '. ' + (item.name || item.product) + ' x' + (item.quantity || 1) + '\n';
                });
            }
            output.textContent += '\n';
        });
        
        // Check for potential duplicates (same address + same total)
        output.textContent += '\n=== CHECKING FOR DUPLICATES ===\n';
        const addressTotals = new Map();
        elonaOrders.forEach(order => {
            const key = order.address + '_' + order.total;
            if (!addressTotals.has(key)) {
                addressTotals.set(key, []);
            }
            addressTotals.get(key).push(order.id);
        });
        
        addressTotals.forEach((ids, key) => {
            if (ids.length > 1) {
                output.textContent += 'DUPLICATE FOUND: ' + key + '\n';
                output.textContent += '  Document IDs: ' + ids.join(', ') + '\n';
            }
        });
        
        if (addressTotals.size === elonaOrders.length) {
            output.textContent += 'No duplicates found - all orders are unique.\n';
        }
        
    } catch (error) {
        output.textContent += 'ERROR: ' + error.message;
    }
}

checkDuplicates();
</script>
</body>
</html>
