<!DOCTYPE html>
<html>
<head><title>Check Firebase Data</title></head>
<body>
<h2>Checking Firebase Data Structure...</h2>
<pre id="output"></pre>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
import { getFirestore, collection, getDocs, query, limit } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyDUtblUqNiSCmC4kRjikE7D2kba0Mhxej4",
    authDomain: "danfosal-app.firebaseapp.com",
    projectId: "danfosal-app",
    storageBucket: "danfosal-app.appspot.com",
    messagingSenderId: "565855692028",
    appId: "1:565855692028:web:c7cb647497cb3df9452379"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const output = document.getElementById('output');

async function checkData() {
    try {
        // Get first 5 online orders
        const ordersSnap = await getDocs(query(collection(db, 'onlineOrders'), limit(5)));
        
        output.textContent += '=== ONLINE ORDERS SAMPLE ===\n';
        output.textContent += 'Total documents: ' + ordersSnap.size + '\n\n';
        
        ordersSnap.docs.forEach((doc, index) => {
            const data = doc.data();
            output.textContent += '--- Order ' + (index + 1) + ' (ID: ' + doc.id.substring(0, 8) + '...) ---\n';
            output.textContent += 'Customer: ' + (data.clientName || 'N/A') + '\n';
            output.textContent += 'Address: ' + (data.address || data.deliveryAddress || 'N/A') + '\n';
            output.textContent += 'Items array: ' + (data.items ? data.items.length + ' items' : 'No items array') + '\n';
            if (data.items && data.items.length > 0) {
                data.items.forEach((item, i) => {
                    output.textContent += '  Item ' + (i+1) + ': ' + (item.name || item.product) + ' x' + (item.quantity || 1) + '\n';
                });
            }
            output.textContent += 'Total: ' + (data.total || data.price || 0) + '\n\n';
        });
        
        // Count total orders by customer name
        const allOrdersSnap = await getDocs(collection(db, 'onlineOrders'));
        const customerCounts = {};
        
        allOrdersSnap.docs.forEach(doc => {
            const customer = doc.data().clientName || 'Unknown';
            customerCounts[customer] = (customerCounts[customer] || 0) + 1;
        });
        
        output.textContent += '\n=== CUSTOMER ORDER COUNTS (Raw Documents) ===\n';
        Object.entries(customerCounts).sort((a,b) => b[1] - a[1]).slice(0, 10).forEach(([name, count]) => {
            output.textContent += name + ': ' + count + ' documents\n';
        });
        
    } catch (error) {
        output.textContent += 'ERROR: ' + error.message;
    }
}

checkData();
</script>
</body>
</html>
